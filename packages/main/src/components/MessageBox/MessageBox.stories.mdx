import { Title, Subtitle, Description, Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs/blocks';
import { DocsHeader } from '@shared/stories/DocsHeader';
import { Button } from '@ui5/webcomponents-react/lib/Button';
import { MessageBox } from '@ui5/webcomponents-react/lib/MessageBox';
import { MessageBoxActions } from '@ui5/webcomponents-react/lib/MessageBoxActions';
import { MessageBoxTypes } from '@ui5/webcomponents-react/lib/MessageBoxTypes';
import { useRef, useCallback } from 'react';
import { createSelectArgTypes } from '@shared/stories/createSelectArgTypes';

<Meta
  title="Components / MessageBox"
  component={MessageBox}
  argTypes={{ ref: { type: null }, ...createSelectArgTypes({ type: MessageBoxTypes }) }}
  args={{
    open: false,
    type: MessageBoxTypes.CONFIRM,
    children: 'Press "Escape" to close the MessageBox.'
  }}
/>

<DocsHeader />

<br />

### Opening MessageBoxes

`MessageBoxes` can only be opened by attaching a `ref` to the component and then call the corresponding **`open`** method.

```JSX
const MessageBoxComponent = () => {
  const messageBoxRef = useRef();
  const onButtonClick = () => {
    messageBoxRef.current.open();
  };
  return (
    <>
      <Button onClick={onButtonClick}>Open MessageBox</Button>
      <MessageBox ref={messageBoxRef}>Some Content</MessageBox>
    </>
  );
};
```

<Canvas>
  <Story name="Default">
    {(args) => {
      const messageBoxRef = useRef();
      const onButtonClick = (e) => {
        messageBoxRef.current.open();
      };
      const onCloseMessageBox = (e) => {
        args.onClose(e);
        messageBoxRef.current.close();
      };
      return (
        <>
          <Button onClick={onButtonClick}>Open Messagebox</Button>
          <MessageBox {...args} ref={messageBoxRef} onClose={onCloseMessageBox} />
        </>
      );
    }}
  </Story>
</Canvas>

<ArgsTable story="." />

### Using MessageBoxes inside other components

`MessageBoxes` are often used within other components, when opened this could sometimes have unwanted side effects.
In this case, we recommend using [createPortal](https://reactjs.org/docs/portals.html) to mount the `MessageBox` outside of the DOM hierarchy of the parent component.

```JSX
const MessageBoxComponent = () => {
  const messageBoxRef = useRef();
  const onButtonClick = () => {
    messageBoxRef.current.open();
  };
  return (
    <>
      <Button onClick={onButtonClick}>Open MessageBox</Button>
      {createPortal(
        <MessageBox ref={messageBoxRef}>Some Content</MessageBox>,
        document.body
      )}
    </>
  );
};
```

### Closing MessageBoxes

Closing `MessageBoxes` works in the same way as opening them. So again an attached `ref` is needed on which the corresponding `close` method is called.
You can use the `onClose` prop of the `MessageBox` to close it by clicking on an action button.

```JSX
const MessageBoxComponent = () => {
  const messageBoxRef = useRef();
  const handleOpen = (e) => {
    messageBoxRef.current.open();
  };
  const handleClose = () => {
    messageBoxRef.current.close();
  };
  return (
    <>
      <Button onClick={handleOpen}>Open MessageBox</Button>
      <MessageBox ref={messageBoxRef} onClose={handleClose}>
        Some Content
      </MessageBox>
    </>
  );
};
```

<br />

# Stories

<br />

## MessageBox with custom actions

<Canvas>
  <Story name="With Custom Action">
    {(args) => {
      const messageBoxRef = useRef();
      const onButtonClick = (e) => {
        messageBoxRef.current.open();
      };
      const onCloseMessageBox = (e) => {
        messageBoxRef.current.close();
      };
      return (
        <>
          <Button onClick={onButtonClick}>Open Messagebox</Button>
          <MessageBox
            ref={messageBoxRef}
            type={args.type}
            open={args.open}
            onClose={onCloseMessageBox}
            title={args.title}
            actions={[MessageBoxActions.OK, 'A custom action', MessageBoxActions.CANCEL]}
          >
            {args.children}
          </MessageBox>
        </>
      );
    }}
  </Story>
</Canvas>
